<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiagent.mapper.MessageSourceMapper">

    <resultMap id="BaseResultMap" type="com.aiagent.model.MessageSource">
        <id column="id" property="id"/>
        <result column="message_id" property="messageId"/>
        <result column="document_id" property="documentId"/>
        <result column="chunk_id" property="chunkId"/>
        <result column="similarity" property="similarity"/>
        <result column="created_at" property="createdAt"/>
    </resultMap>

    <insert id="insert">
        INSERT INTO message_sources (id, message_id, document_id, chunk_id, similarity, created_at)
        VALUES (#{id}, #{messageId}, #{documentId}, #{chunkId}, #{similarity}, #{createdAt})
    </insert>

    <insert id="insertBatch">
        INSERT INTO message_sources (id, message_id, document_id, chunk_id, similarity, created_at)
        VALUES
        <foreach collection="sources" item="source" separator=",">
            (#{source.id}, #{source.messageId}, #{source.documentId}, #{source.chunkId}, #{source.similarity}, #{source.createdAt})
        </foreach>
    </insert>

    <select id="selectByMessageId" resultMap="BaseResultMap">
        SELECT * FROM message_sources
        WHERE message_id = #{messageId}
        ORDER BY similarity DESC
    </select>

</mapper>

