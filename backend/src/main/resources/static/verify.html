<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>éªŒè¯è¯·æ±‚åˆ°è¾¾åç«¯</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .box { background: white; padding: 20px; border-radius: 10px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” éªŒè¯è¯·æ±‚æ˜¯å¦åˆ°è¾¾åç«¯ç³»ç»Ÿ</h1>
    
    <div class="box">
        <h2>1. åç«¯æœåŠ¡æ£€æŸ¥</h2>
        <div id="backendCheck">æ£€æŸ¥ä¸­...</div>
    </div>
    
    <div class="box">
        <h2>2. å‘é€æµ‹è¯•è¯·æ±‚</h2>
        <button onclick="sendTest()">å‘é€æµ‹è¯•æ¶ˆæ¯</button>
        <div id="testResult" style="margin-top: 10px;"></div>
    </div>
    
    <div class="box">
        <h2>3. è¯·æ±‚è¯¦æƒ…</h2>
        <pre id="requestDetails">ç­‰å¾…æµ‹è¯•...</pre>
    </div>

    <script>
        // æ£€æŸ¥åç«¯
        fetch('http://localhost:8080/api/test/health')
            .then(r => r.json())
            .then(data => {
                document.getElementById('backendCheck').innerHTML = 
                    data.status === 'ok' 
                        ? '<span class="success">âœ… åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸</span>' 
                        : '<span class="error">âŒ åç«¯æœåŠ¡å¼‚å¸¸</span>';
            })
            .catch(e => {
                document.getElementById('backendCheck').innerHTML = 
                    '<span class="error">âŒ æ— æ³•è¿æ¥åˆ°åç«¯: ' + e.message + '</span>';
            });

        function sendTest() {
            const resultDiv = document.getElementById('testResult');
            const detailsDiv = document.getElementById('requestDetails');
            
            resultDiv.innerHTML = 'â³ å‘é€ä¸­...';
            detailsDiv.textContent = 'ç­‰å¾…å“åº”...';
            
            const testMsg = 'éªŒè¯æµ‹è¯•ï¼š' + new Date().toLocaleTimeString();
            const startTime = Date.now();
            
            fetch('http://localhost:8080/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: testMsg, useRAG: false })
            })
            .then(response => {
                const endTime = Date.now();
                const duration = ((endTime - startTime) / 1000).toFixed(2);
                
                return response.json().then(data => {
                    if (data.success && data.data) {
                        resultDiv.innerHTML = `
                            <span class="success">âœ… è¯·æ±‚æˆåŠŸåˆ°è¾¾åç«¯ï¼</span><br>
                            <strong>å“åº”æ—¶é—´:</strong> ${duration}ç§’<br>
                            <strong>AI å›å¤:</strong> ${data.data.message.substring(0, 100)}...<br>
                            <strong>æ¨¡å‹:</strong> ${data.data.metadata?.model || 'N/A'}<br>
                            <strong>åç«¯å¤„ç†æ—¶é—´:</strong> ${data.data.metadata?.responseTime?.toFixed(2) || 'N/A'}ç§’
                        `;
                        
                        detailsDiv.textContent = JSON.stringify(data, null, 2);
                    } else {
                        resultDiv.innerHTML = '<span class="error">âŒ è¯·æ±‚å¤±è´¥</span>';
                        detailsDiv.textContent = JSON.stringify(data, null, 2);
                    }
                });
            })
            .catch(error => {
                resultDiv.innerHTML = '<span class="error">âŒ è¯·æ±‚å¼‚å¸¸: ' + error.message + '</span>';
                detailsDiv.textContent = 'é”™è¯¯: ' + error.message;
            });
        }
    </script>
</body>
</html>

